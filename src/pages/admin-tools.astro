---
import '../styles/globals.css'
---

<!doctype html>
<html lang="hr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex, nofollow" />
    <title>Admin Tools - Eko Leventiƒá</title>
  </head>
  <body class="bg-gray-50">
    <div class="min-h-screen flex items-center justify-center p-4">
      <div class="bg-white rounded-lg shadow-lg p-8 max-w-2xl w-full">
        <h1 class="text-3xl font-bold text-green-800 mb-6">
          üõ†Ô∏è Admin Alati
        </h1>

        <div class="space-y-6">
          <!-- Seed Products -->
          <div class="border border-gray-200 rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-3">
              üì¶ Napuni Proizvode u Supabase
            </h2>
            <p class="text-gray-600 mb-4">
              Ova akcija ƒáe dodati sve proizvode iz <code class="bg-gray-100 px-2 py-1 rounded">src/data/products.ts</code> u Supabase bazu podataka.
            </p>
            <button
              id="seedButton"
              class="bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-3 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Pokreni Seed
            </button>
            <div id="seedResult" class="mt-4 hidden"></div>
          </div>

          <!-- Link to Admin Panel -->
          <div class="border border-gray-200 rounded-lg p-6 bg-blue-50">
            <h2 class="text-xl font-semibold mb-3">
              üåæ Admin Panel
            </h2>
            <p class="text-gray-600 mb-4">
              Nakon ≈°to napunite proizvode, mo≈æete otiƒái na admin panel za upravljanje.
            </p>
            <a
              href="/admin"
              class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-lg transition"
            >
              Otvori Admin Panel
            </a>
          </div>
        </div>
      </div>
    </div>

    <script>
      const seedButton = document.getElementById('seedButton') as HTMLButtonElement
      const seedResult = document.getElementById('seedResult') as HTMLDivElement

      seedButton.addEventListener('click', async () => {
        seedButton.disabled = true
        seedButton.textContent = 'Punjenje...'
        seedResult.innerHTML = '<p class="text-gray-600">‚è≥ Punjenje proizvoda u Supabase...</p>'
        seedResult.classList.remove('hidden')

        try {
          const response = await fetch('/api/admin/seed-products', {
            method: 'POST',
          })

          const result = await response.json()

          if (response.ok) {
            let html = `
              <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                <h3 class="font-semibold text-green-900 mb-2">‚úÖ Uspje≈°no!</h3>
                <p class="text-green-800 mb-2">
                  Ukupno: ${result.total} | Uspje≈°no: ${result.success} | Gre≈°ke: ${result.errors}
                </p>
                <details class="mt-3">
                  <summary class="cursor-pointer text-sm text-green-700 hover:text-green-900">
                    Prika≈æi detalje
                  </summary>
                  <div class="mt-2 max-h-64 overflow-y-auto">
                    <ul class="text-sm space-y-1">
            `

            result.results.forEach((r: any) => {
              if (r.status === 'success') {
                html += `<li class="text-green-700">‚úÖ ${r.product}</li>`
              } else {
                html += `<li class="text-red-700">‚ùå ${r.product}: ${r.message}</li>`
              }
            })

            html += `
                    </ul>
                  </div>
                </details>
              </div>
            `

            seedResult.innerHTML = html
          } else {
            seedResult.innerHTML = `
              <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                <h3 class="font-semibold text-red-900 mb-2">‚ùå Gre≈°ka</h3>
                <p class="text-red-800">${result.error || 'Nepoznata gre≈°ka'}</p>
                <p class="text-sm text-red-700 mt-2">${result.message || ''}</p>
              </div>
            `
          }
        } catch (error) {
          seedResult.innerHTML = `
            <div class="bg-red-50 border border-red-200 rounded-lg p-4">
              <h3 class="font-semibold text-red-900 mb-2">‚ùå Gre≈°ka</h3>
              <p class="text-red-800">${error instanceof Error ? error.message : 'Nepoznata gre≈°ka'}</p>
            </div>
          `
        } finally {
          seedButton.disabled = false
          seedButton.textContent = 'Pokreni Seed'
        }
      })
    </script>
  </body>
</html>

